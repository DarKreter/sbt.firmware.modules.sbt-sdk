set(HEADER_LIST
        SBT-SDK.hpp
        Hardware/Hardware.hpp
        System/Task.hpp
        System/TaskManager.hpp
        )

set(SRC_LIST
        SBT-SDK.cpp
        Error.cpp
        Hardware/Hardware.cpp
        Hardware/GPIO.cpp
        Hardware/UART.cpp
        Hardware/SPI.cpp
        Hardware/I2C.cpp
        System/Task.cpp
        System/TaskManager.cpp
        Hardware/DMA.cpp
        Hardware/ADC.cpp
        )

if (NOT DEFINED ENV{SBT_HEARTBEAT_DISABLE})
    set(SRC_LIST
            ${SRC_LIST}
            System/Tasks/Heartbeat.cpp
            )
endif ()

if (NOT DEFINED ENV{SBT_CAN_DISABLE})
    set(SRC_LIST
            ${SRC_LIST}
            Hardware/CAN.cpp
            System/Communication/CAN/CommCAN.cpp
            System/Communication/CAN/CanMessage.cpp
            System/Communication/CAN/CanParser_autogenerated.cpp
            )
    if (NOT DEFINED ENV{SBT_CAN_SENDER_DISABLE})
        set(SRC_LIST
                ${SRC_LIST}
                System/Tasks/CanSender.cpp
                )
    endif ()
    if (NOT DEFINED ENV{SBT_CAN_RECEIVER_DISABLE})
        set(SRC_LIST
                ${SRC_LIST}
                System/Tasks/CanReceiver.cpp
                )
    endif ()
endif ()

add_library(SBT-SDK ${SRC_LIST} ${HEADER_LIST})

target_include_directories(SBT-SDK PUBLIC . Hardware System System/Tasks System/Communication/CAN BSP)

target_link_libraries(SBT-SDK PUBLIC STM32Cube-F1)
target_link_libraries(SBT-SDK PUBLIC FreeRTOS-Kernel)

add_dependencies(SBT-SDK STM32Cube-F1)
add_dependencies(SBT-SDK FreeRTOS-Kernel)
